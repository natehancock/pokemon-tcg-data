openapi: 3.0.3
info:
  title: Pokemon TCG Models
  description: |
    API for accessing Pokemon Trading Card Game data including cards, sets, and pricing information.
    This specification is shared between the pokemon-tcg-data backend service and CardViewer iOS application.
  version: 2.0.0
  contact:
    name: Pokemon TCG Data API

servers:
  - url: https://pokemon-tcg-data.onrender.com/v2
    description: Production server
  - url: http://localhost:3000/v2
    description: Development server

tags:
  - name: cards
    description: Pokemon card operations
  - name: sets
    description: Card set operations
  - name: pokemon
    description: Pokemon-specific operations
  - name: pokedexes
    description: Pokedex operations

paths:
  /cards:
    get:
      tags:
        - cards
      summary: Get all cards
      description: Returns all Pokemon cards with enriched set information
      operationId: getAllCards
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CardsResponse'
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /cards/filter:
    get:
      tags:
        - cards
      summary: Filter cards
      description: Filter cards by multiple criteria including types, subtypes, years, sets, and rarities
      operationId: getFilteredCards
      parameters:
        - name: types
          in: query
          description: Comma-separated list of Pokemon types (e.g., Fire,Water,Psychic)
          required: false
          schema:
            type: string
          example: Fire,Water
        - name: subtypes
          in: query
          description: Comma-separated list of card subtypes (e.g., Basic,Stage 1,EX)
          required: false
          schema:
            type: string
          example: Basic,Stage 1
        - name: years
          in: query
          description: Comma-separated list of release years
          required: false
          schema:
            type: string
          example: 1999,2000
        - name: sets
          in: query
          description: Comma-separated list of set IDs
          required: false
          schema:
            type: string
          example: base1,base2
        - name: rarities
          in: query
          description: Comma-separated list of rarities (e.g., Rare,Rare Holo)
          required: false
          schema:
            type: string
          example: Rare Holo
      responses:
        '200':
          description: Successful response with filtered cards
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/FilterResponse'
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /cards/{id}:
    get:
      tags:
        - cards
      summary: Get a single card
      description: Returns a single Pokemon card by its ID (format "setId-cardNumber")
      operationId: getCardById
      parameters:
        - name: id
          in: path
          description: Card ID in format "setId-cardNumber" (e.g., "base1-1")
          required: true
          schema:
            type: string
          example: base1-1
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CardResponse'
        '404':
          description: Card not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /sets:
    get:
      tags:
        - sets
      summary: Get all sets
      description: Returns all Pokemon TCG set metadata
      operationId: getAllSets
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SetsResponse'
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /sets/{id}:
    get:
      tags:
        - sets
      summary: Get a single set
      description: Returns a single Pokemon TCG set by its ID
      operationId: getSetById
      parameters:
        - name: id
          in: path
          description: Set ID (e.g., "base1", "jungle")
          required: true
          schema:
            type: string
          example: base1
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SetResponse'
        '404':
          description: Set not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /pokemon:
    get:
      tags:
        - pokemon
      summary: Get all Pokemon
      description: Returns all Pokemon cards grouped by National Pokedex number
      operationId: getAllPokemon
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PokedexResponse'
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /pokemon/types:
    get:
      tags:
        - pokemon
      summary: Get all Pokemon types
      description: Returns all Pokemon types with their colors and metadata
      operationId: getPokemonTypes
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TypesResponse'
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /pokemon/moves:
    get:
      tags:
        - pokemon
      summary: Get all Pokemon moves
      description: Returns all Pokemon moves from the move database
      operationId: getPokemonMoves
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MovesResponse'
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /pokemon/abilities:
    get:
      tags:
        - pokemon
      summary: Get all Pokemon abilities
      description: Returns all Pokemon abilities from the ability database
      operationId: getPokemonAbilities
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AbilitiesResponse'
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /pokemon/species:
    get:
      tags:
        - pokemon
      summary: Get all Pokemon species
      description: Returns all Pokemon species with stats, types, and evolution data
      operationId: getPokemonSpecies
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SpeciesResponse'
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /pokedexes:
    get:
      tags:
        - pokedexes
      summary: Get all Pokedexes
      description: Returns all Pokedex types (National, Regional, etc.)
      operationId: getAllPokedexes
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PokedexesResponse'
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /pokedexes/{id}:
    get:
      tags:
        - pokedexes
      summary: Get a single Pokedex
      description: Returns a specific Pokedex with its entries
      operationId: getPokedexById
      parameters:
        - name: id
          in: path
          description: Pokedex ID (e.g., "national", "kanto")
          required: true
          schema:
            type: string
          example: national
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Pokedex'
        '404':
          description: Pokedex not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /pokedexes/{id}/entries:
    get:
      tags:
        - pokedexes
      summary: Get Pokedex entries
      description: Returns all Pokemon entries for a specific Pokedex
      operationId: getPokedexEntries
      parameters:
        - name: id
          in: path
          description: Pokedex ID (e.g., "national", "kanto")
          required: true
          schema:
            type: string
          example: national
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PokedexEntriesResponse'
        '404':
          description: Pokedex not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

components:
  schemas:
    PokemonCard:
      type: object
      required:
        - id
        - name
        - supertype
        - set
        - number
        - images
      properties:
        id:
          type: string
          description: Unique card identifier in format "setId-cardNumber"
          example: base1-1
        name:
          type: string
          description: Card or Pokemon name
          example: Alakazam
        supertype:
          type: string
          description: Card supertype
          enum:
            - Pokémon
            - Trainer
            - Energy
          example: Pokémon
        subtypes:
          type: array
          description: Card subtypes (e.g., Basic, Stage 1, Stage 2, EX, GX, VMAX)
          items:
            type: string
          example: [Stage 2]
        level:
          type: string
          description: Pokemon level (older card format)
          example: "42"
        hp:
          type: string
          description: Hit points
          example: "80"
        types:
          type: array
          description: Pokemon energy types
          items:
            type: string
          example: [Psychic]
        evolvesFrom:
          type: string
          description: Name of Pokemon this evolves from
          example: Kadabra
        evolvesTo:
          type: array
          description: Names of Pokemon this can evolve to
          items:
            type: string
        abilities:
          type: array
          description: Pokemon abilities or powers
          items:
            $ref: '#/components/schemas/Ability'
        attacks:
          type: array
          description: Pokemon attacks
          items:
            $ref: '#/components/schemas/Attack'
        weaknesses:
          type: array
          description: Type weaknesses
          items:
            $ref: '#/components/schemas/TypeEffect'
        resistances:
          type: array
          description: Type resistances
          items:
            $ref: '#/components/schemas/TypeEffect'
        retreatCost:
          type: array
          description: Energy types required to retreat
          items:
            type: string
          example: [Colorless, Colorless, Colorless]
        convertedRetreatCost:
          type: integer
          description: Numeric retreat cost
          example: 3
        number:
          type: string
          description: Card number in set
          example: "1"
        artist:
          type: string
          description: Card artist name
          example: Ken Sugimori
        rarity:
          type: string
          description: Card rarity
          example: Rare Holo
        flavorText:
          type: string
          description: Flavor text or lore
        nationalPokedexNumbers:
          type: array
          description: National Pokedex numbers
          items:
            type: integer
          example: [65]
        legalities:
          type: object
          description: Format legalities
          additionalProperties:
            type: string
          example:
            unlimited: Legal
        images:
          $ref: '#/components/schemas/CardImages'
        tcgplayer:
          $ref: '#/components/schemas/TCGPlayer'
        cardmarket:
          $ref: '#/components/schemas/CardMarket'
        set:
          $ref: '#/components/schemas/SetInfo'
        rules:
          type: array
          description: Rules text (mainly for Trainer cards)
          items:
            type: string

    SetInfo:
      type: object
      required:
        - id
        - name
        - series
        - total
        - releaseDate
        - year
        - images
      properties:
        id:
          type: string
          description: Set identifier
          example: base1
        name:
          type: string
          description: Set name
          example: Base
        series:
          type: string
          description: Series name
          example: Base
        printedTotal:
          type: integer
          description: Number of cards printed in set
          example: 102
        total:
          type: integer
          description: Total unique cards in set
          example: 102
        legalities:
          type: object
          description: Format legalities
          additionalProperties:
            type: string
        ptcgoCode:
          type: string
          description: Pokemon Trading Card Game Online code
          example: BS
        releaseDate:
          type: string
          description: Release date in yyyy/MM/dd format
          example: "1999/01/09"
        year:
          type: string
          description: Year the set was released (extracted from releaseDate)
          example: "1999"
        updatedAt:
          type: string
          description: Last update timestamp
          example: "2022/10/10 15:12:00"
        images:
          $ref: '#/components/schemas/SetImages'

    Attack:
      type: object
      required:
        - name
      properties:
        name:
          type: string
          description: Attack name
          example: Confuse Ray
        cost:
          type: array
          description: Energy cost requirements
          items:
            type: string
          example: [Psychic, Psychic, Psychic]
        convertedEnergyCost:
          type: integer
          description: Total energy required
          example: 3
        damage:
          type: string
          description: Damage dealt (may include modifiers like +, ×)
          example: "30"
        text:
          type: string
          description: Attack effect description

    Ability:
      type: object
      required:
        - name
        - text
        - type
      properties:
        name:
          type: string
          description: Ability name
          example: Damage Swap
        text:
          type: string
          description: Ability effect description
        type:
          type: string
          description: Ability type (e.g., Pokémon Power, Ability)
          example: Pokémon Power

    TypeEffect:
      type: object
      required:
        - type
        - value
      properties:
        type:
          type: string
          description: Energy type
          example: Psychic
        value:
          type: string
          description: Effect value (e.g., ×2, -30)
          example: "×2"

    CardImages:
      type: object
      required:
        - small
        - large
      properties:
        small:
          type: string
          format: uri
          description: Small card image URL
          example: https://images.pokemontcg.io/base1/1.png
        large:
          type: string
          format: uri
          description: Large card image URL
          example: https://images.pokemontcg.io/base1/1_hires.png

    SetImages:
      type: object
      properties:
        symbol:
          type: string
          format: uri
          description: Set symbol image URL
          example: https://images.pokemontcg.io/base1/symbol.png
        logo:
          type: string
          format: uri
          description: Set logo image URL
          example: https://images.pokemontcg.io/base1/logo.png

    TCGPlayer:
      type: object
      properties:
        url:
          type: string
          format: uri
          description: TCGPlayer product URL
        updatedAt:
          type: string
          format: date-time
          description: Last price update
        prices:
          $ref: '#/components/schemas/TCGPlayerPrices'

    TCGPlayerPrices:
      type: object
      properties:
        holofoil:
          $ref: '#/components/schemas/PriceInfo'
        reverseHolofoil:
          $ref: '#/components/schemas/PriceInfo'
        normal:
          $ref: '#/components/schemas/PriceInfo'
        "1stEditionHolofoil":
          $ref: '#/components/schemas/PriceInfo'
        "1stEditionNormal":
          $ref: '#/components/schemas/PriceInfo'

    CardMarket:
      type: object
      properties:
        url:
          type: string
          format: uri
          description: CardMarket product URL
        updatedAt:
          type: string
          format: date-time
          description: Last price update
        prices:
          $ref: '#/components/schemas/CardMarketPrices'

    CardMarketPrices:
      type: object
      properties:
        averageSellPrice:
          type: number
          format: double
          description: Average sell price
        lowPrice:
          type: number
          format: double
          description: Lowest price
        trendPrice:
          type: number
          format: double
          description: Trending price
        reverseHoloSell:
          type: number
          format: double
          description: Reverse holo average sell price
        reverseHoloLow:
          type: number
          format: double
          description: Reverse holo lowest price
        reverseHoloTrend:
          type: number
          format: double
          description: Reverse holo trending price

    PriceInfo:
      type: object
      properties:
        low:
          type: number
          format: double
          description: Low price
        mid:
          type: number
          format: double
          description: Mid price
        high:
          type: number
          format: double
          description: High price
        market:
          type: number
          format: double
          description: Market price
        directLow:
          type: number
          format: double
          description: Direct low price

    CardsResponse:
      type: object
      required:
        - cards
      properties:
        cards:
          type: array
          items:
            $ref: '#/components/schemas/PokemonCard'

    FilterResponse:
      type: object
      required:
        - cards
        - count
      properties:
        cards:
          type: array
          items:
            $ref: '#/components/schemas/PokemonCard'
        count:
          type: integer
          description: Number of cards returned
        filters:
          type: object
          description: Applied filters
          properties:
            types:
              type: array
              items:
                type: string
            subtypes:
              type: array
              items:
                type: string
            years:
              type: array
              items:
                type: string
            sets:
              type: array
              items:
                type: string
            rarities:
              type: array
              items:
                type: string

    SetsResponse:
      type: object
      required:
        - sets
      properties:
        sets:
          type: array
          items:
            $ref: '#/components/schemas/SetInfo'

    PokemonByPokedex:
      type: object
      required:
        - name
        - nationalPokedexNumber
        - cards
      properties:
        name:
          type: string
          description: Pokemon name
          example: Pikachu
        nationalPokedexNumber:
          type: integer
          description: National Pokedex number
          example: 25
        cards:
          type: array
          description: All cards for this Pokemon
          items:
            $ref: '#/components/schemas/PokemonCard'

    PokedexResponse:
      type: object
      required:
        - pokemon
        - count
      properties:
        pokemon:
          type: array
          items:
            $ref: '#/components/schemas/PokemonByPokedex'
        count:
          type: integer
          description: Number of unique Pokemon

    CardResponse:
      type: object
      required:
        - card
      properties:
        card:
          $ref: '#/components/schemas/PokemonCard'

    SetResponse:
      type: object
      required:
        - set
      properties:
        set:
          $ref: '#/components/schemas/SetInfo'

    PokemonType:
      type: object
      required:
        - id
        - name
      properties:
        id:
          type: integer
          description: Type ID
          example: 1
        name:
          type: string
          description: Type name
          example: Fire
        color:
          type: string
          description: Type color (hex format)
          example: "#FF0000"
        isCanonical:
          type: boolean
          description: Whether this is a canonical Pokemon type
          example: true

    TypesResponse:
      type: object
      required:
        - types
      properties:
        types:
          type: array
          items:
            $ref: '#/components/schemas/PokemonType'

    PokemonMove:
      type: object
      required:
        - id
        - name
      properties:
        id:
          type: integer
          description: Move ID
          example: 1
        name:
          type: string
          description: Move name
          example: Thunderbolt
        power:
          type: integer
          description: Base power of the move
          example: 90
        accuracy:
          type: integer
          description: Accuracy percentage
          example: 100
        pp:
          type: integer
          description: Power points
          example: 15
        type:
          type: string
          description: Move type
          example: Electric
        damageClass:
          type: string
          description: Damage class (physical, special, status)
          example: special
        effectChance:
          type: integer
          description: Chance of effect occurring
        generation:
          type: integer
          description: Generation introduced
          example: 1
        description:
          type: string
          description: Move description

    MovesResponse:
      type: object
      required:
        - moves
      properties:
        moves:
          type: array
          items:
            $ref: '#/components/schemas/PokemonMove'

    PokemonAbility:
      type: object
      required:
        - id
        - name
      properties:
        id:
          type: integer
          description: Ability ID
          example: 1
        name:
          type: string
          description: Ability name
          example: Static
        description:
          type: string
          description: Ability description
          example: The Pokémon is charged with static electricity and may paralyze attackers that make direct contact with it.
        generation:
          type: integer
          description: Generation introduced
          example: 3
        isHidden:
          type: boolean
          description: Whether this is a hidden ability

    AbilitiesResponse:
      type: object
      required:
        - abilities
      properties:
        abilities:
          type: array
          items:
            $ref: '#/components/schemas/PokemonAbility'

    PokemonSpecies:
      type: object
      required:
        - id
        - name
      properties:
        id:
          type: integer
          description: National Pokedex number
          example: 25
        name:
          type: string
          description: Pokemon name
          example: Pikachu
        types:
          type: array
          description: Pokemon types
          items:
            type: string
          example: [Electric]
        baseStats:
          type: object
          description: Base stats
          properties:
            hp:
              type: integer
            attack:
              type: integer
            defense:
              type: integer
            specialAttack:
              type: integer
            specialDefense:
              type: integer
            speed:
              type: integer
        height:
          type: number
          description: Height in meters
          example: 0.4
        weight:
          type: number
          description: Weight in kilograms
          example: 6.0
        generation:
          type: integer
          description: Generation introduced
          example: 1
        evolutionChain:
          type: object
          description: Evolution chain data
        abilities:
          type: array
          description: Pokemon abilities
          items:
            type: string

    SpeciesResponse:
      type: object
      required:
        - species
      properties:
        species:
          type: array
          items:
            $ref: '#/components/schemas/PokemonSpecies'

    Pokedex:
      type: object
      required:
        - id
        - name
      properties:
        id:
          type: string
          description: Pokedex identifier
          example: national
        name:
          type: string
          description: Pokedex name
          example: National Pokédex
        description:
          type: string
          description: Pokedex description
        region:
          type: string
          description: Associated region
          example: Kanto
        entries:
          type: array
          description: Pokemon entries in this Pokedex
          items:
            $ref: '#/components/schemas/PokedexEntry'

    PokedexEntry:
      type: object
      required:
        - entryNumber
        - pokemonId
        - pokemonName
      properties:
        entryNumber:
          type: integer
          description: Entry number in this Pokedex
          example: 1
        pokemonId:
          type: integer
          description: National Pokedex number
          example: 1
        pokemonName:
          type: string
          description: Pokemon name
          example: Bulbasaur

    PokedexesResponse:
      type: object
      required:
        - pokedexes
      properties:
        pokedexes:
          type: array
          items:
            $ref: '#/components/schemas/Pokedex'

    PokedexEntriesResponse:
      type: object
      required:
        - entries
      properties:
        entries:
          type: array
          items:
            $ref: '#/components/schemas/PokedexEntry'

    Error:
      type: object
      required:
        - message
      properties:
        message:
          type: string
          description: Error message
        code:
          type: string
          description: Error code
